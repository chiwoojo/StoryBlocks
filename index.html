<!doctype html>
<html>

  <head>
    <title>CollaboraStory</title>
    <!-- Google Icon Font -->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Materialize.CSS -->
    <link rel="stylesheet" type="text/css" href="materialize/css/materialize.min.css">
    <!-- Main CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- qtips library CSS - CDN -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/qtip2/2.2.1/basic/jquery.qtip.min.css">
    
    <!-- Let browser know it is optimized for Mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  
  <body>
    <div id="messages"></div>
    <form action="" id="username-form">
      <input id="u" autocomplete="off" /><button>Change username</button>
    </form>
    <form action="" id="message-form">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
    <div class="login page">
      <div class="form">
        <h3 class="title">Your name?</h3>
        <input class="usernameInput" type="text" maxlength="15">
      </div>
    </div>
    <!-- Socket IO client library -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <!-- Materialize.JS -->
    <script type="text/javascript" src="materialize/js/materialize.min.js"></script>
    <!-- qtip JS library for tooltips -->
    <script src="https://cdn.jsdelivr.net/qtip2/2.2.1/basic/jquery.qtip.min.js"></script>
    <script>
      var socket = io();
      
      var data = {
        username : '',
        message : ''
      };
      
      //send message
      $('#message-form').submit(function(e) {
        e.preventDefault();
        var message = $('#m').val() + ' ';
        var username = data.username === '' ? 'Anon' : data.username;
        socket.emit('chat message', {message: message, username: username});
        $('#m').val('');
        return false; 
      });
      
      //change user name
      $('#username-form').submit(function(e) {
        e.preventDefault();
        var username = $('#u').val();
        data.username = username;
        return false;
      });
      
      //when emit 'chat message' fires from server
      socket.on('chat message', function(data) {
        console.log('Data is ', data);
        var messageDiv = $('<div>')
                           .attr('id', data.uniqueId)
                           .attr('class', 'message')
                           .attr('title', data.username)
                           .text(data.message);
        $('#messages').append(messageDiv);
        $('#' + data.uniqueId).qtip();
      });      
      
    </script>
  </body>
</html>